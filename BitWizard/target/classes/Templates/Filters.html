<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <title>Filtra Viaggi</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      padding: 20px;
      background-color: #f4f4f4;
    }
    h1 {
      color: #333;
    }
    form {
      margin-bottom: 20px;
    }
    input, select {
      margin-right: 10px;
    }
    .results {
      margin-top: 20px;
      border: 1px solid #ccc;
      padding: 10px;
      background-color: #fff;
    }
  </style>
</head>
<body>

<h1>Filtra i tuoi Viaggi</h1>

<!-- Filter by Tag -->
<form id="filterByTag">
  <h2>Filtra per Tag</h2>
  <label for="tagId">Tag ID:</label>
  <input type="number" id="tagId" required>
  <button type="submit">Cerca</button>
</form>

<!-- Filter by Age -->
<form id="filterByAge">
  <h2>Filtra per Età</h2>
  <label for="minAge">Età Minima:</label>
  <input type="number" id="minAge" required>
  <label for="maxAge">Età Massima:</label>
  <input type="number" id="maxAge" required>
  <button type="submit">Cerca</button>
</form>

<!-- Filter by Destination -->
<form id="filterByDestination">
  <h2>Filtra per Destinazione</h2>
  <label for="destinazione">Destinazione:</label>
  <input type="text" id="destinazione" required>
  <button type="submit">Cerca</button>
</form>

<!-- Filter by Departure -->
<form id="filterByPartenza">
  <h2>Filtra per Partenza</h2>
  <label for="partenza">Partenza:</label>
  <input type="text" id="partenza" required>
  <button type="submit">Cerca</button>
</form>

<!-- Filter by Price -->
<form id="filterByPrezzo">
  <h2>Filtra per Prezzo</h2>
  <label for="minPrezzo">Prezzo Minimo:</label>
  <input type="number" id="minPrezzo" required>
  <label for="maxPrezzo">Prezzo Massimo:</label>
  <input type="number" id="maxPrezzo" required>
  <button type="submit">Cerca</button>
</form>


<div id="cardContainer" class="row">
<!-- Le card dei viaggi verranno inserite qui dinamicamente -->
</div>

<script>

  async function fetchData(url) {
    const response = await fetch(url);

    if (!response.ok) {
      const errorText = await response.text();
      throw new Error(errorText);
    }

    return await response.json();
  }
  
  function createViaggioCard(viaggio) {
	    const dataPartenza = new Date(viaggio.dataPartenza).toLocaleDateString();
	    const dataRitorno = new Date(viaggio.dataRitorno).toLocaleDateString();

	    return `
	      <div class="col-md-4">
	        <div class="card mb-4">
	          <img src="/api/viaggi/${viaggio.viaggioId}/immagine" class="card-img-top" alt="Immagine del viaggio">
	          <div class="card-body">
	            <h5 class="card-title">${viaggio.nome}</h5>
	            <p class="card-text">
	              Luogo di Partenza: ${viaggio.luogoPartenza} <br>
	              Luogo di Arrivo: ${viaggio.luogoArrivo} <br>
	              Data di Partenza: ${dataPartenza} <br>
	              Data di Ritorno: ${dataRitorno} <br>
	              Prezzo: €${viaggio.prezzo.toFixed(2)}
	            </p>
	            <a href="/paginaViaggio/viaggio?viaggioId=${viaggio.viaggioId}" class="btn btn-primary">Dettagli del viaggio</a>
	          </div>
	        </div>
	      </div>
	    `;
	  }

	  function displayResults(results) {
	    const resultsContainer = document.getElementById('results');
	    resultsContainer.innerHTML = results.map(createViaggioCard).join('');
	  }

	  document.getElementById('filterByTag').addEventListener('submit', async (e) => {
		    e.preventDefault();

		    const tagId = document.getElementById('tagId').value;
		    const container = document.getElementById('cardContainer');

		    try {
		        const result = await fetchData(`api/viaggi/filtra/tag?tagId=${tagId}`);
		        result.forEach(viaggio => {
		            container.innerHTML += createViaggioCard(viaggio);
		        });
		    } catch (error) {
		        container.innerText = error.message;
		    }
		});


  document.getElementById('filterByAge').addEventListener('submit', async (e) => {
    e.preventDefault();

    const minAge = document.getElementById('minAge').value;
    const maxAge = document.getElementById('maxAge').value;
    const container = document.getElementById('cardContainer');

    try {
      const result = await fetchData(`api/viaggi/filtra/eta?min=${minAge}&max=${maxAge}`);
      result.forEach(viaggio => {
          container.innerHTML += createViaggioCard(viaggio);
      });
  } catch (error) {
      container.innerText = error.message;
  }
  });

  document.getElementById('filterByDestination').addEventListener('submit', async (e) => {
    e.preventDefault();

    const destinazione = document.getElementById('destinazione').value;
    const container = document.getElementById('cardContainer');

    try {
      const result = await fetchData(`api/viaggi/filtra/destinazione?destinazione=${destinazione}`);
      result.forEach(viaggio => {
          container.innerHTML += createViaggioCard(viaggio);
      });
  } catch (error) {
      container.innerText = error.message;
  }
  });

  document.getElementById('filterByPartenza').addEventListener('submit', async (e) => {
    e.preventDefault();

    const partenza = document.getElementById('partenza').value;
    const container = document.getElementById('cardContainer');

    try {
      const result = await fetchData(`api/viaggi/filtra/partenza?partenza=${partenza}`);
      result.forEach(viaggio => {
          container.innerHTML += createViaggioCard(viaggio);
      });
  } catch (error) {
      container.innerText = error.message;
  }
  });

  document.getElementById('filterByPrezzo').addEventListener('submit', async (e) => {
    e.preventDefault();

    const minPrezzo = document.getElementById('minPrezzo').value;
    const maxPrezzo = document.getElementById('maxPrezzo').value;
    const container = document.getElementById('cardContainer');

    try {
      const result = await fetchData(`api/viaggi/filtra/prezzo?min=${minPrezzo}&max=${maxPrezzo}`);
      result.forEach(viaggio => {
          container.innerHTML += createViaggioCard(viaggio);
      });
  } catch (error) {
      container.innerText = error.message;
  }
  });
</script>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</body>
</html>